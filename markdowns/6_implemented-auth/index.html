<!DOCTYPE html>
<div class="padding-md w-md"><h1 id="認証処理を考える">認証処理を考える</h1><hr/><div class="content"><p>以前案件でログインしている時だけ遷移できるページの実装をした。<br/>
Vueの場合はVueRouterに処理を追加したり、Nuxtの場合はmidlewareを追加していたが、<br/>
Astroだとどうやって実装すれば良いのか調べる。</p><h2 id="layoutsに追加する">layoutsに追加する</h2><p>公式は下記のようにpagesに認証している場合のみ遷移させるlayoutを実装することを推奨していた</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">&lt;</span><span style="color:#7EE787">script</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">let</span><span style="color:#C9D1D9"> isLoggedIn </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> localStorage.</span><span style="color:#D2A8FF">getItem</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">&#39;isLoggedIn&#39;</span><span style="color:#C9D1D9">);</span><span style="color:#8B949E">//認証情報を保持しているか確認する</span></span>
<span class="line"><span style="color:#C9D1D9">    console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(isLoggedIn);</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">//保持していない場合はログイン画面に遷移させる</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (isLoggedIn </span><span style="color:#FF7B72">===</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">||</span><span style="color:#C9D1D9"> isLoggedIn </span><span style="color:#FF7B72">===</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;&#39;</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">||</span><span style="color:#C9D1D9"> isLoggedIn </span><span style="color:#FF7B72">===</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;false&#39;</span><span style="color:#C9D1D9">) {</span></span>
<span class="line"><span style="color:#C9D1D9">        window.location.href </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">import</span><span style="color:#C9D1D9">.</span><span style="color:#79C0FF">meta</span><span style="color:#C9D1D9">.env.</span><span style="color:#79C0FF">BASE_URL</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">+</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;login&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">    }</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">script</span><span style="color:#C9D1D9">&gt;</span></span></code></pre><p>実際にこのサイトが上記の認証の実装をしているので各自で確認してみてください。</p></div></div>