<!DOCTYPE html>
<div class="padding-md w-md"><h1 id="store使う">Store使う</h1><hr/><div class="content"><p>Vueが使えることはわかったし公式のtutorialにも記載あるのでまあ、いろいろフレームワーク入れれるのはわかったが、これStateの管理はどうするんだ？<br/>
VueだとVuexとかReactだとReduxとかそれぞれ別々の状態管理していたと思う。ので気になったので調べて使ってみた。</p><h2 id="nanostores">nanostores</h2><p>どうやら公式はnanostoresを使用して状態の管理を実施してほしいらしい
以下のコマンドでインストール</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npm i nanostores</span></span>
<span class="line"><span style="color:#C9D1D9">npm install nanostores @nanostores/persistent //localStorageに値を保持するためのライブラリ</span></span></code></pre><p>storeのファイルを作成してmutationとかの処理を追加</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">//stores/counter.ts</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { persistentAtom } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;@nanostores/persistent&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">initialValue</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> { value: </span><span style="color:#79C0FF">0</span><span style="color:#C9D1D9"> };</span></span>
<span class="line"><span style="color:#8B949E">//MPAなのでページ間でStoreの値を参照、更新できるよう設定</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">counter</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">persistentAtom</span><span style="color:#C9D1D9">&lt;</span><span style="color:#79C0FF">number</span><span style="color:#C9D1D9">&gt;(</span><span style="color:#A5D6FF">&#39;counter&#39;</span><span style="color:#C9D1D9">, initialValue.value, {</span></span>
<span class="line"><span style="color:#C9D1D9">    encode: </span><span style="color:#79C0FF">JSON</span><span style="color:#C9D1D9">.stringify,</span></span>
<span class="line"><span style="color:#C9D1D9">    decode: </span><span style="color:#79C0FF">JSON</span><span style="color:#C9D1D9">.parse,</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">increaseCounter</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> counter.</span><span style="color:#D2A8FF">set</span><span style="color:#C9D1D9">(counter.</span><span style="color:#D2A8FF">get</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">+</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">1</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">decreaseCounter</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> counter.</span><span style="color:#D2A8FF">set</span><span style="color:#C9D1D9">(counter.</span><span style="color:#D2A8FF">get</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">-</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">1</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">cleanCounter</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> counter.</span><span style="color:#D2A8FF">set</span><span style="color:#C9D1D9">(initialValue.value);</span></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#C9D1D9"> { counter, increaseCounter, decreaseCounter, cleanCounter };</span></span></code></pre><h2 id="reactで使う">reactで使う</h2><p>reactで使う場合は下記のコマンドを実行して追加でライブラリを入れる</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npm i nanostores @nanostores/react</span></span></code></pre><p>※reactのインテグレーションの設定をしていない場合は下記のコマンドを実行して設定する</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npx astro </span><span style="color:#79C0FF">add</span><span style="color:#C9D1D9"> react</span></span></code></pre><p>コンポーネントで使用する</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useStore } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;@nanostores/react&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { counter, increaseCounter, decreaseCounter } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;../stores/counter&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">function</span><span style="color:#FFA657"> </span><span style="color:#D2A8FF">React</span><span style="color:#FFA657">() </span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">count</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useStore</span><span style="color:#C9D1D9">(counter);</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">name</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;React&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            &lt;</span><span style="color:#7EE787">p</span><span style="color:#C9D1D9">&gt; </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">name</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> のコンポーネント&lt;/</span><span style="color:#7EE787">p</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            &lt;</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">onClick</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">decreaseCounter</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;-&lt;/</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            &lt;</span><span style="color:#7EE787">pre</span><span style="color:#C9D1D9">&gt;</span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">count</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">pre</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            &lt;</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">onClick</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">increaseCounter</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;+&lt;/</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre><h2 id="vueで使う">vueで使う</h2><p>reactで使う場合は下記のコマンドを実行して追加でライブラリを入れる</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npm i nanostores @nanostores/vue</span></span></code></pre><p>コンポーネントで使用する</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">template</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">p</span><span style="color:#C9D1D9">&gt;{{ name }}のコンポーネント&lt;/</span><span style="color:#7EE787">p</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">@click</span><span style="color:#C9D1D9">=</span><span style="color:#A5D6FF">&quot;decreaseCounter&quot;</span><span style="color:#C9D1D9">&gt;-&lt;/</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">pre</span><span style="color:#C9D1D9">&gt;{{ count }}&lt;/</span><span style="color:#7EE787">pre</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">@click</span><span style="color:#C9D1D9">=</span><span style="color:#A5D6FF">&quot;increaseCounter&quot;</span><span style="color:#C9D1D9">&gt;+&lt;/</span><span style="color:#7EE787">button</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">template</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">script</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">setup</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">lang</span><span style="color:#C9D1D9">=</span><span style="color:#A5D6FF">&quot;ts&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useStore } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;@nanostores/vue&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { counter, increaseCounter, decreaseCounter } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;../stores/counter&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">count</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useStore</span><span style="color:#C9D1D9">(counter);</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">name</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;Vue&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">script</span><span style="color:#C9D1D9">&gt;</span></span></code></pre><h2 id="実際に使ってみる">実際に使ってみる</h2><p>下記のようにimportして使ってみる</p><pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">---</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> CounterVue </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;../components/CounterVue.vue&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> CounterReact </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;../components/CounterReact.jsx&#39;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#8B949E">---</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;</span><span style="color:#7EE787">CounterVue</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">client:load</span><span style="color:#C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;</span><span style="color:#7EE787">CounterReact</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">client:load</span><span style="color:#C9D1D9"> /&gt;</span></span></code></pre><p>↓以下は実際の描画</p></div></div>