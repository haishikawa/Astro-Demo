let N=(e,u,l,s)=>(e.events=e.events||{},e.events[l+10]||(e.events[l+10]=s(t=>{e.events[l].reduceRight((i,r)=>(r(i),i),{shared:{},...t})})),e.events[l]=e.events[l]||[],e.events[l].push(u),()=>{let t=e.events[l],i=t.indexOf(u);t.splice(i,1),t.length||(delete e.events[l],e.events[l+10](),delete e.events[l+10])}),g=1e3,O=(e,u)=>N(e,s=>{let t=u(s);t&&e.events[6].push(t)},5,s=>{let t=e.listen;e.listen=(...r)=>(!e.lc&&!e.active&&(e.active=!0,s()),t(...r));let i=e.off;return e.events[6]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let r of e.events[6])r();e.events[6]=[]}},g)},()=>{e.listen=t,e.off=i}}),f=[],U=(e,u)=>{let l,s=[],t={lc:0,l:u||0,value:e,set(i){t.value=i,t.notify()},get(){return t.lc||t.listen(()=>{})(),t.value},notify(i){l=s;let r=!f.length;for(let n=0;n<l.length;n+=2)f.push(l[n],t.value,i,l[n+1]);if(r){for(let n=0;n<f.length;n+=4){let d=!1;for(let c=n+7;c<f.length;c+=4)if(f[c]<f[n+3]){d=!0;break}d?f.push(f[n],f[n+1],f[n+2],f[n+3]):f[n](f[n+1],f[n+2])}f.length=0}},listen(i,r){return s===l&&(s=s.slice()),t.lc=s.push(i,r||t.l)/2,()=>{s===l&&(s=s.slice());let n=s.indexOf(i);~n&&(s.splice(n,2),t.lc--,t.lc||t.off())}},subscribe(i,r){let n=t.listen(i,r);return i(t.value),n},off(){}};return t},T=e=>e,o={},v={addEventListener(){},removeEventListener(){}};function h(){try{return typeof localStorage<"u"}catch{return!1}}h()&&(o=localStorage);let p={addEventListener(e,u){window.addEventListener("storage",u)},removeEventListener(e,u){window.removeEventListener("storage",u)}};typeof window<"u"&&(v=p);function L(e,u=void 0,l={}){let s=l.encode||T,t=l.decode||T,i=U(u),r=i.set;i.set=d=>{typeof d>"u"?delete o[e]:o[e]=s(d),r(d)};function n(d){d.key===e?d.newValue===null?r(void 0):r(t(d.newValue)):o[e]||r(void 0)}return O(i,()=>{if(i.set(o[e]?t(o[e]):u),l.listen!==!1)return v.addEventListener(e,n),()=>{v.removeEventListener(e,n)}}),i}const E={value:0},a=L("counter",E.value,{encode:JSON.stringify,decode:JSON.parse}),M=()=>a.set(a.get()+1),R=()=>a.set(a.get()-1),w=()=>a.set(E.value);export{w as a,a as c,R as d,M as i};
